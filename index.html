<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>እሁድን በፍቅር - Mini App</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Tailwind CSS for modern UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #1a1a1a);
            --brand-green: #15803d; 
            --tg-btn: var(--tg-theme-button-color, #15803d);
            --tg-btn-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary: var(--tg-theme-secondary-bg-color, #f9fafb);
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0; overflow-x: hidden;
        }

        .input-group input, .input-group select, .input-group textarea {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            border: 1.5px solid #e5e7eb;
            transition: border-color 0.2s;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            border-color: var(--brand-green);
            outline: none;
        }

        .active-tab {
            border-bottom: 4px solid var(--brand-green);
            color: var(--brand-green);
            font-weight: 800;
        }

        .logo-container {
            background: linear-gradient(135deg, var(--brand-green), #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashed-border { border: 2px dashed #15803d44; }

        /* Animation */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .gateway-card {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 45px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.1s;
        }

        .gateway-card:active {
            transform: scale(0.95);
        }

        .gateway-card img {
            max-height: 24px;
            max-width: 100%;
            object-fit: contain;
        }

        #modalOverlay {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="p-4 select-none">
    <div class="max-w-md mx-auto">
        
        <!-- Header Section -->
        <div class="text-center mb-6 mt-2">
            <div class="flex flex-col justify-center items-center mb-2">
                <!-- Main Branding Logo -->
                <img src="logo.jpg" alt="Logo" class="w-24 h-24 rounded-2xl shadow-xl mb-3 object-cover border-2 border-green-700" onerror="this.src='https://ui-avatars.com/api/?name=%E1%8A%A5%E1%88%81%E1%8%B5%E1%8A%95+%E1%8A%A2%E1%8%B5%E1%8A%95&background=15803d&color=fff&size=128'">
                <h1 class="text-2xl font-black logo-container tracking-tight uppercase">እሁድን በፍቅር</h1>
            </div>
            <div class="h-1 w-16 bg-green-700 mx-auto rounded-full opacity-20 mb-2"></div>
            <p id="navHint" class="text-[14px] font-black uppercase tracking-widest text-green-700">እዚህ ይክፈሉ (Pay Here)</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex justify-around border-b mb-6 border-gray-100 bg-white sticky top-0 z-10">
            <button onclick="showTab('payment')" id="payTab" class="flex-1 py-4 text-sm transition-all active-tab uppercase">ክፍያ ሪፖርት</button>
            <button onclick="showTab('loan')" id="loanTab" class="flex-1 py-4 text-sm transition-all opacity-40 uppercase">ብድር</button>
        </div>

        <!-- Payment Section -->
        <div id="paymentSection" class="fade-in">
            <form id="paymentForm" class="space-y-5">
                <div class="input-group">
                    <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">የክፍያ ዓላማ</label>
                    <select id="purpose" class="w-full p-4 rounded-2xl shadow-sm outline-none">
                        <option value="Monthly Fee">የወርሃዊ መዋጮ (Monthly Fee)</option>
                        <option value="Loan Payment">የብድር መመለሻ (Loan Repayment)</option>
                        <option value="Penalty">የቅጣት ክፍያ (Penalty)</option>
                        <option value="Special">ልዩ መዋጮ (Special Contribution)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">የከፈሉበት መንገድ</label>
                    <select id="location" class="w-full p-4 rounded-2xl shadow-sm outline-none">
                        <option value="Telebirr">ቴሌብር (Telebirr)</option>
                        <option value="CBE Bank">የኢትዮጵያ ንግድ ባንክ (CBE)</option>
                        <option value="Other Banks">ሌሎች ባንኮች (Other Banks)</option>
                        <option value="In Cash">በጥሬ ገንዘብ / በእጅ (In Cash Only)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">መደበኛ ክፍያ (ብር)</label>
                        <input type="number" id="baseAmount" placeholder="500" required class="w-full p-4 rounded-2xl font-mono font-bold shadow-sm">
                    </div>
                    <div class="input-group">
                        <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">የቅጣት መጠን (ብር)</label>
                        <input type="number" id="penaltyAmount" placeholder="0" class="w-full p-4 rounded-2xl font-mono shadow-sm">
                    </div>
                </div>

                <div class="input-group">
                    <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">የደረሰኝ መረጃ (Receipt)</label>
                    <div class="dashed-border w-full p-6 rounded-3xl text-center bg-green-50/20 border-green-700/30">
                        <span class="text-[10px] font-semibold text-green-800 leading-tight">ፎርሙን ከጨረሱ በኋላ የደረሰኙን ፎቶ በቴሌግራም ቻቱ ላይ መላክዎን አይርሱ!</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="text-[11px] font-black ml-1 mb-1.5 block uppercase text-green-800 opacity-80">ተጨማሪ ማስታወሻ</label>
                    <textarea id="note" placeholder="ለምሳሌ፡ የጥቅምት ወር ክፍያ..." class="w-full p-4 rounded-2xl h-20 resize-none shadow-sm"></textarea>
                </div>

                <!-- Submit Button & Easy Pay Label -->
                <div class="flex flex-col items-center space-y-4 pt-2">
                    <button type="submit" class="w-full py-5 rounded-3xl font-black text-lg shadow-xl active:scale-95 transition-all" style="background-color: var(--tg-btn); color: var(--tg-btn-text);">
                        ደረሰኝ ላክ
                    </button>
                    
                    <div class="flex flex-col items-center w-full">
                        <p class="text-[12px] font-black uppercase text-green-700 tracking-widest mb-4 italic">በቀላሉ እዚህ ይክፈሉ (Easy Pay Here)</p>
                        <div class="flex justify-center gap-3 w-full">
                            <!-- Gateways with construction modal -->
                            <div class="gateway-card" onclick="showConstructionModal('Chapa')">
                                <img src="Chapa.png" alt="Chapa" onerror="this.parentElement.innerText='CHAPA'">
                            </div>
                            <div class="gateway-card" onclick="showConstructionModal('ArifPay')">
                                <img src="ArifPay.png" alt="Arifpay" onerror="this.parentElement.innerText='Arifpay'">
                            </div>
                            <div class="gateway-card" onclick="showConstructionModal('StarPay')">
                                <img src="StarPay.png" alt="StarPay" onerror="this.parentElement.innerText='StarPay'">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Loan Section (Placeholder) -->
        <div id="loanSection" class="hidden fade-in">
            <div class="bg-green-50 border-2 border-green-700/20 p-8 rounded-[2.5rem] text-center shadow-inner">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <h3 class="text-xl font-black text-green-800 mb-2 uppercase tracking-tight">በዝግጅት ላይ</h3>
                <p class="text-sm font-medium text-green-900/70 mb-6 leading-relaxed">የብድር አገልግሎት በአሁኑ ሰዓት በዝግጅት ላይ ነው። በቅርቡ አገልግሎት መስጠት እንጀምራለን።</p>
                <hr class="border-green-700/10 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2 uppercase">Under Development</h3>
                <p class="text-xs font-medium text-gray-500 leading-relaxed">Loan service is currently under development and will be active in the next update.</p>
            </div>
            <button onclick="showTab('payment')" class="w-full py-4 mt-6 text-sm font-bold text-green-800 opacity-60 hover:opacity-100 transition-opacity">
                ← ወደ ክፍያ ተመለስ (Back to Payment)
            </button>
        </div>

        <!-- Footer -->
        <div class="flex flex-col items-center mt-12 mb-8 opacity-40">
            <p class="text-[10px] font-bold tracking-widest uppercase mb-1 text-green-900">እሁድን በፍቅር Digital v2.1</p>
            <p class="text-[9px] font-bold text-green-800 tracking-tighter uppercase">POWERED BY SKYMARK SYSTEM SOLUTION</p>
        </div>
    </div>

    <!-- Construction Modal Overlay -->
    <div id="modalOverlay" class="fixed inset-0 z-50 flex items-center justify-center hidden opacity-0">
        <div class="bg-white w-[85%] max-w-sm rounded-[2rem] p-8 shadow-2xl transform scale-90 transition-all duration-300" id="modalBox">
            <div class="text-center">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 class="text-xl font-black text-gray-800 mb-2 uppercase tracking-tight">በዝግጅት ላይ</h3>
                <p class="text-sm font-medium text-gray-600 mb-6 leading-relaxed">
                    ይህ የ<span id="gatewayName" class="font-bold text-green-700"></span> በቀጥታ የመክፈያ ዘዴ በአሁኑ ሰዓት በዝግጅት ላይ ነው። በቅርቡ አገልግሎት መስጠት እንጀምራለን።
                </p>
                <div class="border-t border-gray-100 pt-6">
                    <button onclick="closeConstructionModal()" class="w-full py-4 bg-green-700 text-white rounded-2xl font-bold shadow-lg shadow-green-900/20 active:scale-95 transition-all uppercase">
                        እሺ (OK)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.setHeaderColor(tg.themeParams.bg_color || '#ffffff');

        // Handle commands launched from bot (Deep Linking/Routing)
        window.onload = () => {
            const startParam = tg.initDataUnsafe.start_param;
            if (startParam === 'pay') {
                showTab('payment');
            } else if (startParam === 'loan') {
                showTab('loan');
            } else {
                showTab('payment'); // Default
            }
        };

        function showTab(tab) {
            const paymentSection = document.getElementById('paymentSection');
            const loanSection = document.getElementById('loanSection');
            const payTab = document.getElementById('payTab');
            const loanTab = document.getElementById('loanTab');
            const hint = document.getElementById('navHint');

            if (tab === 'payment') {
                paymentSection.classList.remove('hidden');
                loanSection.classList.add('hidden');
                payTab.classList.add('active-tab');
                payTab.classList.remove('opacity-40');
                loanTab.classList.remove('active-tab');
                loanTab.classList.add('opacity-40');
                hint.innerText = "እዚህ ይክፈሉ (Pay Here)";
            } else {
                paymentSection.classList.add('hidden');
                loanSection.classList.remove('hidden');
                loanTab.classList.add('active-tab');
                loanTab.classList.remove('opacity-40');
                payTab.classList.remove('active-tab');
                payTab.classList.add('opacity-40');
                hint.innerText = "የብድር አገልግሎት (Loan Service)";
            }
        }

        function showConstructionModal(name) {
            const overlay = document.getElementById('modalOverlay');
            const box = document.getElementById('modalBox');
            document.getElementById('gatewayName').innerText = name;
            
            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.add('opacity-100');
                box.classList.remove('scale-90');
                box.classList.add('scale-100');
            }, 10);
        }

        function closeConstructionModal() {
            const overlay = document.getElementById('modalOverlay');
            const box = document.getElementById('modalBox');
            
            overlay.classList.remove('opacity-100');
            box.classList.remove('scale-100');
            box.classList.add('scale-90');
            
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, 300);
        }

        document.getElementById('paymentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Collect Form Data
            const base = parseFloat(document.getElementById('baseAmount').value) || 0;
            const penalty = parseFloat(document.getElementById('penaltyAmount').value) || 0;
            const purpose = document.getElementById('purpose').value;
            const location = document.getElementById('location').value;
            const note = document.getElementById('note').value;

            // Prepare JSON Payload for Bot
            const data = {
                type: 'payment_report',
                purpose: purpose,
                location: location,
                base_amount: base,
                penalty_amount: penalty,
                totalAmount: base + penalty,
                note: note
            };
            
            // Send data to Telegram Bot and close Mini App
            tg.sendData(JSON.stringify(data));
        });
    </script>
</body>
</html>
