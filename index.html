<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠ - Edir Digital Pro</title>
    <!-- SDKs -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@100..900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #f1f5f9);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #0f172a);
            --brand-green: #15803d;
            --brand-light: #f0fdf4;
            --card-border: rgba(226, 232, 240, 0.8);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --tg-bg: var(--tg-theme-bg-color, #0f172a);
                --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #1e293b);
                --tg-text: var(--tg-theme-text-color, #f8fafc);
                --card-border: rgba(51, 65, 85, 0.5);
                --brand-light: rgba(21, 128, 61, 0.1);
            }
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: 'Noto Sans Ethiopic', 'Inter', sans-serif;
            margin: 0; padding: 0;
            transition: all 0.3s ease;
        }

        .section-card {
            background-color: var(--tg-secondary-bg);
            border: 1px solid var(--card-border);
            border-radius: 2rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .input-style {
            background-color: var(--tg-bg);
            border: 2px solid var(--card-border);
            border-radius: 1.25rem;
            padding: 0.875rem 1.25rem;
            width: 100%;
            font-size: 16px;
            color: var(--tg-text);
            transition: all 0.2s ease;
            outline: none;
        }

        .method-card {
            border: 2px solid var(--card-border);
            border-radius: 1.5rem;
            padding: 1.25rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: var(--tg-secondary-bg);
        }

        .method-card.selected {
            border-color: var(--brand-green);
            background-color: var(--brand-light);
            transform: scale(0.98);
        }

        .tab-btn { 
            padding: 10px 4px; 
            border-radius: 1rem; 
            font-weight: 700; 
            font-size: 12px; 
            color: var(--tg-text);
            opacity: 0.6;
            transition: all 0.3s ease;
        }

        .active-tab { 
            color: var(--brand-green) !important; 
            background: var(--tg-secondary-bg);
            opacity: 1;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .animate-section { 
            animation: slideUp 0.4s ease-out forwards; 
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-5 pb-10">

    <header class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-green-700 rounded-2xl flex items-center justify-center text-3xl shadow-lg">üè°</div>
            <div>
                <h1 class="text-lg font-black leading-tight">·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠</h1>
                <p id="dateDisplay" class="text-[10px] font-bold opacity-50 uppercase"></p>
            </div>
        </div>
        <div class="text-right">
            <span id="userName" class="text-sm font-black block">·ä†·â£·àç</span>
            <span class="text-[10px] opacity-40 uppercase font-bold tracking-tighter">Edir Digital Pro</span>
        </div>
    </header>

    <nav id="mainNav" class="bg-black/5 p-1 rounded-2xl grid grid-cols-4 gap-1 mb-8">
        <button onclick="showTab('payment')" id="payTab" class="tab-btn active-tab">·ä≠·çç·ã´</button>
        <button onclick="showTab('status')" id="statTab" class="tab-btn">·àÅ·äî·â≥</button>
        <button onclick="showTab('loan')" id="loanTab" class="tab-btn">·â•·ãµ·à≠</button>
        <button onclick="showTab('help')" id="helpTab" class="tab-btn">·ä•·à≠·ã≥·â≥</button>
    </nav>

    <!-- Payment Section -->
    <div id="paymentSection" class="animate-section">
        <form id="paymentForm" class="space-y-6">
            <!-- Payer Selection -->
            <div class="section-card space-y-5">
                <h3 class="text-[11px] font-black uppercase opacity-40 tracking-widest">·ä≠·çç·ã´·ãç ·àà·àõ·äï ·äê·ãç?</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div id="selfPay" class="method-card selected" onclick="togglePayer('self')">
                        <span class="text-3xl block mb-2">üôã‚Äç‚ôÇÔ∏è</span>
                        <span class="text-xs font-black uppercase">·àà·ä•·äî</span>
                    </div>
                    <div id="otherPay" class="method-card" onclick="togglePayer('other')">
                        <span class="text-3xl block mb-2">üë•</span>
                        <span class="text-xs font-black uppercase">·àà·àå·àã ·à∞·ãç</span>
                    </div>
                </div>
                <div id="otherMemberBox" class="hidden mt-4 pt-2">
                    <label class="text-[11px] font-bold uppercase opacity-50 mb-2 block ml-2">·ã®·ä†·â£·àâ ·àµ·àù/Username</label>
                    <input type="text" id="targetMember" placeholder="@username ·ãà·ã≠·àù ·àô·àâ ·àµ·àù" class="input-style">
                </div>
            </div>

            <!-- Details Card -->
            <div class="section-card space-y-6">
                <div class="space-y-2">
                    <label class="text-[11px] font-bold uppercase opacity-50 ml-2">·ã®·ä≠·çç·ã´ ·ãì·ã≠·äê·âµ</label>
                    <select id="purpose" class="input-style" onchange="autoCalculatePenalty()">
                        <option value="·àò·ã∞·â†·äõ ·àò·ãã·åÆ">·àò·ã∞·â†·äõ ·àò·ãã·åÆ</option>
                        <option value="·ã®·â•·ãµ·à≠ ·àò·àò·àà·àª">·ã®·â•·ãµ·à≠ ·àò·àò·àà·àª</option>
                        <option value="·ã®·âÖ·å£·âµ ·ä≠·çç·ã´">·ã®·âÖ·å£·âµ ·ä≠·çç·ã´</option>
                    </select>
                </div>

                <div class="space-y-2">
                    <label class="text-[11px] font-bold uppercase opacity-50 ml-2">·ã®·ä≠·çç·ã´ ·ãà·à≠/·åä·ãú</label>
                    <select id="period" class="input-style">
                        <option value="·àò·àµ·ä®·à®·àù">·àò·àµ·ä®·à®·àù</option><option value="·å•·âÖ·àù·âµ">·å•·âÖ·àù·âµ</option>
                        <option value="·àÖ·ã≥·à≠">·àÖ·ã≥·à≠</option><option value="·â≥·àÖ·à≥·àµ">·â≥·àÖ·à≥·àµ</option>
                        <option value="·å•·à≠">·å•·à≠</option><option value="·ã®·ä´·â≤·âµ">·ã®·ä´·â≤·âµ</option>
                        <option value="·àò·åã·â¢·âµ">·àò·åã·â¢·âµ</option><option value="·àö·ã´·ãù·ã´">·àö·ã´·ãù·ã´</option>
                        <option value="·åç·äï·â¶·âµ">·åç·äï·â¶·âµ</option><option value="·à∞·äî">·à∞·äî</option>
                        <option value="·àê·àù·àå">·àê·àù·àå</option><option value="·äê·àê·à¥">·äê·àê·à¥</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold uppercase opacity-50 ml-2">·àò·å†·äï (·â•·à≠)</label>
                        <input type="number" id="amount" placeholder="0.00" required class="input-style text-green-700 font-black">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold uppercase opacity-50 ml-2">·âÖ·å£·âµ (·â•·à≠)</label>
                        <input type="number" id="penalty" value="0" class="input-style text-red-600 font-black">
                        <p id="penaltyHint" class="text-[9px] text-red-500 font-bold mt-1 ml-2"></p>
                    </div>
                </div>
            </div>

            <!-- Payment Method -->
            <div class="section-card space-y-5">
                <h3 class="text-[11px] font-black uppercase opacity-40 tracking-widest">·ã®·ä≠·çç·ã´ ·àò·äï·åà·ãµ</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div id="mManual" class="method-card selected py-4" onclick="setMode('manual')">
                        <span class="text-xl block mb-1">üßæ</span>
                        <span class="text-[11px] font-black uppercase">·â†·ã∞·à®·à∞·äù</span>
                    </div>
                    <div id="mEasy" class="method-card py-4" onclick="setMode('easypay')">
                        <span class="text-xl block mb-1">üí≥</span>
                        <span class="text-[11px] font-black uppercase">·ã≤·åÇ·â≥·àç</span>
                    </div>
                </div>
            </div>

            <button type="submit" class="w-full py-5 bg-green-700 text-white rounded-[1.5rem] font-black text-lg shadow-xl active:scale-[0.97] transition-all flex items-center justify-center gap-3">
                ·àò·à®·åÉ·ãç·äï ·àã·ä≠
            </button>
        </form>
    </div>

    <!-- Other sections (Status, Loan, Help) same as before -->
    <div id="statusSection" class="hidden animate-section p-4 text-center">
        <h2 class="text-xl font-black">·ã®·àÅ·äî·â≥ ·àò·ä®·â≥·â∞·ã´</h2>
        <p class="opacity-50 mt-4 italic">·ä≠·çç·ã´·ãé ·à≤·å∏·ãµ·âÖ ·ä•·ãö·àÖ ·åã·à≠ ·ã≠·ãò·àò·äì·àç::</p>
    </div>
    <div id="loanSection" class="hidden animate-section p-10 text-center">
        <h2 class="text-xl font-black">·ã®·â•·ãµ·à≠ ·ä†·åà·àç·åç·àé·âµ</h2>
        <p class="opacity-50 mt-4 leading-relaxed">·ä†·åà·àç·åç·àé·â± ·â†·àÇ·ã∞·âµ ·àã·ã≠ ·äê·ãç::</p>
    </div>
    <div id="helpSection" class="hidden animate-section p-4">
        <div class="section-card space-y-4">
            <h2 class="text-lg font-black">·ä•·à≠·ã≥·â≥</h2>
            <p class="text-xs opacity-60">·ä®·âÄ·äï 1-5 ·àò·ã∞·â†·äõ ·ä≠·çç·ã´:: ·â†·âÄ·äï 6-10 ·âÖ·å£·âµ 20 ·â•·à≠:: ·ä®·âÄ·äï 11 ·â†·äã·àã ·âÖ·å£·âµ 50 ·â•·à≠::</p>
            <a href="https://t.me/Abiym" class="block w-full py-4 bg-slate-100 text-center rounded-xl font-bold">·ä†·àµ·â∞·ã≥·ã≥·à™·ãç·äï ·ä†·åç·äù</a>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        
        let payerMode = 'self';
        let payMode = 'manual';

        // Auto calculate penalty based on day of month
        function autoCalculatePenalty() {
            const today = new Date().getDate();
            const purpose = document.getElementById('purpose').value;
            const penaltyInput = document.getElementById('penalty');
            const hint = document.getElementById('penaltyHint');
            
            let penalty = 0;
            let note = "";

            // Only apply automatic penalty logic for "·àò·ã∞·â†·äõ ·àò·ãã·åÆ"
            if (purpose === "·àò·ã∞·â†·äõ ·àò·ãã·åÆ") {
                if (today >= 6 && today <= 10) {
                    penalty = 20;
                    note = "·ã®·âÄ·äï 6-10 ·âÖ·å£·âµ (20 ·â•·à≠)";
                } else if (today >= 11) {
                    penalty = 50;
                    note = "·ä®·âÄ·äï 11 ·â†·äã·àã ·âÖ·å£·âµ (50 ·â•·à≠)";
                } else {
                    note = "·àò·ã∞·â†·äõ ·ã®·ä≠·çç·ã´ ·åä·ãú (·âÖ·å£·âµ ·ã®·àà·àù)";
                }
            }

            penaltyInput.value = penalty;
            hint.innerText = note;
        }

        window.showTab = (tabName) => {
            ['payment', 'status', 'loan', 'help'].forEach(s => {
                document.getElementById(s + 'Section').classList.toggle('hidden', s !== tabName);
                document.getElementById(s + 'Tab')?.classList.toggle('active-tab', s === tabName);
            });
            tg.HapticFeedback.impactOccurred('medium');
        };

        window.togglePayer = (mode) => {
            payerMode = mode;
            document.getElementById('selfPay').classList.toggle('selected', mode === 'self');
            document.getElementById('otherPay').classList.toggle('selected', mode === 'other');
            document.getElementById('otherMemberBox').classList.toggle('hidden', mode === 'self');
        };

        window.setMode = (m) => {
            payMode = m;
            document.getElementById('mManual').classList.toggle('selected', m === 'manual');
            document.getElementById('mEasy').classList.toggle('selected', m === 'easypay');
        };

        document.getElementById('paymentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const payload = {
                type: 'payment_report',
                gateway: payMode,
                purpose: document.getElementById('purpose').value,
                period: document.getElementById('period').value,
                amount: document.getElementById('amount').value,
                penalty: document.getElementById('penalty').value,
                payFor: payerMode === 'self' ? 'self' : document.getElementById('targetMember').value
            };
            tg.sendData(JSON.stringify(payload));
            tg.close();
        });

        // Initialize
        if(tg.initDataUnsafe?.user) document.getElementById('userName').innerText = tg.initDataUnsafe.user.first_name;
        document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('am-ET', { month: 'long', day: 'numeric', year: 'numeric' });
        autoCalculatePenalty();
    </script>
</body>
</html>
