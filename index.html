<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠ - Mini App</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Tailwind CSS for modern UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #0f172a); 
            --brand-green: #15803d; 
            --tg-btn: var(--tg-theme-button-color, #15803d);
            --tg-btn-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary: var(--tg-theme-secondary-bg-color, #f1f5f9);
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0; overflow-x: hidden;
            line-height: 1.5;
        }

        .input-group input, .input-group select, .input-group textarea {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            border: 1.5px solid #cbd5e1;
            transition: border-color 0.2s;
            font-size: 16px;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            border-color: var(--brand-green);
            outline: none;
            box-shadow: 0 0 0 2px rgba(21, 128, 61, 0.1);
        }

        .active-tab {
            border-bottom: 4px solid var(--brand-green);
            color: var(--brand-green);
            font-weight: 800;
        }

        .dashed-border { 
            border: 2px dashed #15803d66; 
            background-color: #f0fdf4;
        }

        .gateway-card {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 45px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: pointer;
        }

        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Automatic Staggered Slide-in Animation --- */
        .status-card-item {
            opacity: 0;
            transform: translateX(-50px);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .status-card-item.slide-active {
            opacity: 1;
            transform: translateX(0);
        }

        .pay-now-btn {
            background-color: #15803d;
            color: white;
            padding: 6px 14px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 0 4px 6px -1px rgba(21, 128, 61, 0.2);
        }
    </style>
</head>
<body class="p-4 select-none">
    <div class="max-w-md mx-auto">
        
        <!-- Header Section -->
        <div class="text-center mb-6 mt-2">
            <div class="flex flex-col justify-center items-center mb-2">
                <img src="logo.jpg" alt="Logo" class="w-20 h-20 rounded-2xl shadow-md mb-3 object-cover border-2 border-green-700" onerror="this.src='https://ui-avatars.com/api/?name=%E1%8A%A5%E1%88%81%E1%8%B5%E1%8A%95+%E1%8A%A2%E1%8%B5%E1%8A%95&background=15803d&color=fff&size=128'">
                <h1 class="text-xl font-black text-slate-800 uppercase tracking-tight">·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠</h1>
                <p class="text-lg font-bold text-green-700 mt-1">·à∞·àã·àù <span id="userName">·ä†·â£·àç</span> üëã</p>
            </div>
            <div class="h-1 w-12 bg-green-700 mx-auto rounded-full opacity-30 mb-2"></div>
        </div>

        <!-- Navigation Tabs -->
        <div class="grid grid-cols-4 border-b mb-6 border-gray-200 bg-white sticky top-0 z-10">
            <button onclick="showTab('payment')" id="paymentTab" class="py-4 text-[10px] transition-all active-tab uppercase font-black">·ä≠·çç·ã´</button>
            <button onclick="showTab('loan')" id="loanTab" class="py-4 text-[10px] transition-all opacity-50 uppercase font-black text-slate-700">·â•·ãµ·à≠</button>
            <button onclick="showTab('status')" id="statusTab" class="py-4 text-[10px] transition-all opacity-50 uppercase font-black text-slate-700">·àÅ·äî·â≥</button>
            <button onclick="showTab('help')" id="helpTab" class="py-4 text-[10px] transition-all opacity-50 uppercase font-black text-slate-700">·ä•·à≠·ã≥·â≥</button>
        </div>

        <!-- 1. Payment Section -->
        <div id="paymentSection" class="fade-in space-y-5">
            <form id="paymentForm" class="space-y-5">
                <div class="input-group">
                    <label class="text-[12px] font-bold ml-1 mb-1.5 block uppercase text-slate-700">·ã®·ä≠·çç·ã´ ·ãì·àã·àõ</label>
                    <select id="purpose" class="w-full p-4 rounded-2xl shadow-sm font-semibold">
                        <option value="Monthly Fee">·ã®·ãà·à≠·àÉ·ãä ·àò·ãã·åÆ (Monthly Fee)</option>
                        <option value="Loan Payment">·ã®·â•·ãµ·à≠ ·àò·àò·àà·àª (Loan Repayment)</option>
                        <option value="Penalty">·ã®·âÖ·å£·âµ ·ä≠·çç·ã´ (Penalty)</option>
                        <option value="Special">·àç·ã© ·àò·ãã·åÆ (Special Contribution)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="text-[12px] font-bold ml-1 mb-1.5 block uppercase text-slate-700">·ã®·ä®·çà·àâ·â†·âµ ·àò·äï·åà·ãµ</label>
                    <select id="location" class="w-full p-4 rounded-2xl shadow-sm font-semibold">
                        <option value="Telebirr">·â¥·àå·â•·à≠ (Telebirr)</option>
                        <option value="CBE Bank">·ã®·ä¢·âµ·ãÆ·åµ·ã´ ·äï·åç·ãµ ·â£·äï·ä≠ (CBE)</option>
                        <option value="Other Banks">·àå·àé·âΩ ·â£·äï·äÆ·âΩ (Other Banks)</option>
                        <option value="In Cash">·â†·å•·à¨ ·åà·äï·ãò·â• / ·â†·ä•·åÖ (In Cash Only)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="text-[12px] font-bold ml-1 mb-1.5 block uppercase text-slate-700">·àò·ã∞·â†·äõ ·ä≠·çç·ã´ (·â•·à≠)</label>
                        <input type="number" id="baseAmount" placeholder="500" required class="w-full p-4 rounded-2xl font-mono font-black shadow-sm text-green-700">
                    </div>
                    <div class="input-group">
                        <label class="text-[12px] font-bold ml-1 mb-1.5 block uppercase text-slate-700">·ã®·âÖ·å£·âµ ·àò·å†·äï (·â•·à≠)</label>
                        <input type="number" id="penaltyAmount" placeholder="0" class="w-full p-4 rounded-2xl font-mono font-black shadow-sm text-red-600">
                    </div>
                </div>

                <div class="input-group">
                    <label class="text-[12px] font-bold ml-1 mb-1.5 block uppercase text-slate-700">·ã®·ã∞·à®·à∞·äù ·àò·à®·åÉ (Receipt)</label>
                    <div class="dashed-border w-full p-5 rounded-3xl text-center">
                        <span class="text-[11px] font-bold text-green-900 leading-tight">·çé·à≠·àô·äï ·ä®·å®·à®·à± ·â†·äã·àã ·ã®·ã∞·à®·à∞·äô·äï ·çé·â∂ ·â†·â¥·àå·åç·à´·àù ·âª·â± ·àã·ã≠ ·àò·àã·ä≠·ãé·äï ·ä†·ã≠·à≠·à±!</span>
                    </div>
                </div>

                <div class="flex flex-col items-center space-y-5 pt-2">
                    <button type="submit" class="w-full py-5 rounded-3xl font-black text-lg shadow-lg active:scale-95 transition-all" style="background-color: var(--tg-btn); color: var(--tg-btn-text);">
                        ·ã∞·à®·à∞·äù ·àã·ä≠
                    </button>
                    
                    <div class="flex flex-col items-center w-full">
                        <p class="text-[12px] font-black uppercase text-slate-500 tracking-widest mb-4 italic">·â†·âÄ·àã·àâ ·ä•·ãö·àÖ ·ã≠·ä≠·çà·àâ (Easy Pay Here)</p>
                        <div class="flex justify-center gap-3 w-full">
                            <div class="gateway-card" onclick="showConstructionModal('Chapa')">
                                <img src="Chapa.png" alt="Chapa" class="max-h-6" onerror="this.parentElement.innerText='CHAPA'">
                            </div>
                            <div class="gateway-card" onclick="showConstructionModal('ArifPay')">
                                <img src="ArifPay.png" alt="Arifpay" class="max-h-6" onerror="this.parentElement.innerText='Arifpay'">
                            </div>
                            <div class="gateway-card" onclick="showConstructionModal('StarPay')">
                                <img src="StarPay.png" alt="StarPay" class="max-h-6" onerror="this.parentElement.innerText='StarPay'">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- 2. Status Section -->
        <div id="statusSection" class="hidden fade-in space-y-4">
             <div class="bg-white border-2 border-slate-100 p-6 rounded-3xl shadow-sm space-y-6">
                <h3 class="text-lg font-black text-slate-800 uppercase text-center border-b pb-3">·ã®·ä†·àÅ·äë ·àÅ·äî·â≥ (Status)</h3>
                
                <!-- Fixed Total Balance Card (Always Visible) -->
                <div class="bg-slate-900 p-5 rounded-3xl shadow-xl text-center border-b-4 border-green-500">
                    <span class="text-[11px] font-black text-slate-400 uppercase tracking-widest">·å†·âÖ·àã·àã ·âÄ·à™ ·àÇ·à≥·â•</span>
                    <h2 class="text-3xl font-mono font-black text-white mt-1">0.00 <span class="text-sm">·â•·à≠</span></h2>
                </div>

                <!-- Membership Level Indicator -->
                <div class="space-y-3">
                    <p class="text-[11px] font-black text-slate-500 uppercase ml-1">·ã®·ä†·â£·àç·äê·âµ ·ã∞·à®·åÉ</p>
                    <div id="memberLevelCard" class="flex items-center p-3 rounded-2xl bg-green-50 border border-green-200">
                        <div class="w-4 h-4 rounded-full bg-green-500 mr-3 animate-pulse"></div>
                        <span class="text-sm font-black text-green-800">·å•·à© ·ä†·â£·àç (Good Member)</span>
                    </div>
                    <p id="levelNote" class="text-[10px] text-slate-400 italic text-center">·àÅ·äî·â≥·ãé ·â†·ä≠·çç·ã´ ·àµ·äê-·àµ·à≠·ãì·âµ·ãé ·ã≠·ãà·à∞·äì·àç·ç¢</p>
                </div>

                <hr class="border-slate-100">

                <!-- Staggered Sequential List -->
                <div class="space-y-4" id="statusListContainer">
                    <!-- Card 1: Remaining Fee -->
                    <div class="status-card-item flex justify-between items-center bg-slate-50 p-4 rounded-2xl border-l-4 border-green-600">
                        <div class="flex flex-col">
                            <span class="text-[12px] font-black text-slate-700 uppercase">·âÄ·à™ ·àò·ãã·åÆ</span>
                            <button onclick="showTab('payment')" class="pay-now-btn mt-1">·ä≠·çà·àà·ãç (Pay)</button>
                        </div>
                        <div class="text-right">
                            <span class="text-xl font-mono font-black text-slate-800 block">0.00</span>
                            <span class="text-[9px] text-green-700 font-bold uppercase">·åà·â£·à™ ·àÇ·à≥·â•</span>
                        </div>
                    </div>

                    <!-- Card 2: Remaining Penalty -->
                    <div class="status-card-item flex justify-between items-center bg-slate-50 p-4 rounded-2xl border-l-4 border-red-600">
                        <div class="flex flex-col">
                            <span class="text-[12px] font-black text-slate-700 uppercase">·âÄ·à™ ·âÖ·å£·âµ</span>
                            <button onclick="showTab('payment')" class="pay-now-btn mt-1 bg-red-600">·ä≠·çà·àà·ãç (Pay)</button>
                        </div>
                        <div class="text-right">
                            <span class="text-xl font-mono font-black text-slate-800 block">0.00</span>
                            <span class="text-[9px] text-red-700 font-bold uppercase">·âÄ·à™ ·ä•·ã≥</span>
                        </div>
                    </div>

                    <!-- Card 3: Loan Credit -->
                    <div class="status-card-item flex justify-between items-center bg-slate-50 p-4 rounded-2xl border-l-4 border-blue-600">
                        <div class="flex flex-col">
                            <span class="text-[12px] font-black text-slate-700 uppercase">·ã®·â•·ãµ·à≠ ·àÇ·à≥·â•</span>
                            <span class="text-[9px] text-orange-600 font-bold uppercase mt-1">·â†·ãù·åç·åÖ·âµ ·àã·ã≠</span>
                        </div>
                        <div class="text-right">
                            <span class="text-xl font-mono font-black text-slate-400 block">---</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Loan Section -->
        <div id="loanSection" class="hidden fade-in space-y-6">
            <div class="bg-slate-50 border-2 border-slate-200 p-8 rounded-[2.5rem] text-center shadow-inner">
                <h3 class="text-xl font-black text-slate-800 mb-2 uppercase">·â†·ãù·åç·åÖ·âµ ·àã·ã≠</h3>
                <p class="text-sm font-bold text-slate-600">·ã®·â•·ãµ·à≠ ·ä†·åà·àç·åç·àé·âµ ·â†·âÖ·à≠·â° ·ã≠·åÄ·àù·à´·àç·ç¢</p>
            </div>
            <button onclick="showTab('payment')" class="w-full py-4 text-sm font-black text-green-700 uppercase tracking-widest">‚Üê ·ãà·ã∞ ·ä≠·çç·ã´ ·â∞·àò·àà·àµ</button>
        </div>

        <!-- 4. Help Section -->
        <div id="helpSection" class="hidden fade-in space-y-4">
            <h3 class="text-lg font-black text-slate-800 uppercase text-center">·àò·àò·à™·ã´</h3>
            <div class="bg-white p-5 rounded-3xl border-2 border-slate-100 space-y-3">
                <div class="flex items-center space-x-3">
                    <span class="bg-green-100 text-green-700 w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">1</span>
                    <p class="text-sm font-bold text-slate-700">·àò·åÄ·àò·à™·ã´ ·çé·à≠·àô·äï ·ã≠·àô·àâ</p>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="bg-green-100 text-green-700 w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">2</span>
                    <p class="text-sm font-bold text-slate-700">'·ã∞·à®·à∞·äù ·àã·ä≠' ·ã®·àö·àà·ãç·äï ·ã≠·å´·äë</p>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="bg-green-100 text-green-700 w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">3</span>
                    <p class="text-sm font-bold text-slate-700">·çé·â∂·ãç·äï ·àà·â¶·â± ·â†·âª·âµ ·ã≠·àã·ä©</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="flex flex-col items-center mt-12 mb-8 opacity-60">
            <p class="text-[10px] font-black tracking-widest uppercase text-slate-500">·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠ Digital v2.1</p>
            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">POWERED BY SKYMARK SYSTEM SOLUTION</p>
        </div>
    </div>

    <!-- Construction Modal -->
    <div id="modalOverlay" class="fixed inset-0 z-50 flex items-center justify-center hidden opacity-0 transition-all duration-300">
        <div class="bg-white w-[85%] max-w-sm rounded-[2rem] p-8 shadow-2xl transform scale-90 transition-all duration-300" id="modalBox">
            <div class="text-center">
                <h3 class="text-xl font-black text-slate-800 mb-2 uppercase">·â†·ãù·åç·åÖ·âµ ·àã·ã≠</h3>
                <p class="text-sm font-bold text-slate-600 mb-6 leading-relaxed">
                    ·ã®<span id="gatewayName" class="text-green-700"></span> ·ã®·àò·ä≠·çà·ã´ ·ãò·ã¥ ·â†·âÖ·à≠·â° ·àµ·à´ ·ã≠·åÄ·àù·à´·àç·ç¢
                </p>
                <button onclick="closeConstructionModal()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black uppercase shadow-lg">·ä•·à∫ (OK)</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        window.onload = () => {
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                document.getElementById('userName').innerText = tg.initDataUnsafe.user.first_name;
            }
            const startParam = tg.initDataUnsafe.start_param;
            showTab(startParam || 'payment');
        };

        function showTab(tab) {
            const sections = ['payment', 'loan', 'status', 'help'];
            
            // 1. Hide all sections and reset tab highlights
            sections.forEach(s => {
                const sectionEl = document.getElementById(s + 'Section');
                const tabEl = document.getElementById(s + 'Tab');
                if (sectionEl) sectionEl.classList.add('hidden');
                if (tabEl) {
                    tabEl.classList.add('opacity-50');
                    tabEl.classList.remove('active-tab', 'text-slate-900');
                }
            });

            // 2. Show active section and highlight tab
            const activeSection = document.getElementById(tab + 'Section');
            const activeTab = document.getElementById(tab + 'Tab');
            
            if (activeSection) activeSection.classList.remove('hidden');
            if (activeTab) {
                activeTab.classList.remove('opacity-50');
                activeTab.classList.add('active-tab', 'text-slate-900');
            }

            // 3. Trigger automatic slide-in effect for status cards
            if (tab === 'status') {
                const cards = document.querySelectorAll('.status-card-item');
                // Reset first
                cards.forEach(card => card.classList.remove('slide-active'));
                
                // Automatic staggered animation
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('slide-active');
                    }, (index + 1) * 150); // Each card enters 150ms after the previous one
                });
            }
        }

        function showConstructionModal(name) {
            const overlay = document.getElementById('modalOverlay');
            const box = document.getElementById('modalBox');
            document.getElementById('gatewayName').innerText = name;
            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.add('opacity-100');
                box.classList.remove('scale-90');
                box.classList.add('scale-100');
            }, 10);
        }

        function closeConstructionModal() {
            const overlay = document.getElementById('modalOverlay');
            const box = document.getElementById('modalBox');
            overlay.classList.remove('opacity-100');
            box.classList.add('scale-90');
            setTimeout(() => overlay.classList.add('hidden'), 300);
        }

        document.getElementById('paymentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = {
                type: 'payment_report',
                purpose: document.getElementById('purpose').value,
                location: document.getElementById('location').value,
                base_amount: parseFloat(document.getElementById('baseAmount').value) || 0,
                penalty_amount: parseFloat(document.getElementById('penaltyAmount').value) || 0,
                totalAmount: (parseFloat(document.getElementById('baseAmount').value) || 0) + (parseFloat(document.getElementById('penaltyAmount').value) || 0),
                note: ""
            };
            tg.sendData(JSON.stringify(data));
        });
    </script>
</body>
</html>
