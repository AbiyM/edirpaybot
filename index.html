<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠ - Edir Digital Pro</title>
    <!-- SDKs -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@100..900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #f8fafc);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #0f172a);
            --tg-hint: var(--tg-theme-hint-color, #64748b);
            --brand-green: #15803d;
            --brand-light: rgba(21, 128, 61, 0.08);
            --card-border: rgba(226, 232, 240, 0.8);
        }

        @media (prefers-color-scheme: dark) {
            :root { --card-border: rgba(51, 65, 85, 0.5); }
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            font-family: 'Noto Sans Ethiopic', 'Inter', sans-serif;
            margin: 0; padding: 0; overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease;
            font-size: 16px; /* Optimized font size */
        }

        .glass-header {
            background: rgba(var(--tg-theme-bg-color-rgb, 255, 255, 255), 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
        }

        .nav-container {
            background-color: var(--brand-green);
            box-shadow: 0 10px 25px -5px rgba(21, 128, 61, 0.4);
            border-radius: 1.5rem;
            padding: 6px;
        }

        .nav-btn {
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 800;
            font-size: 13px;
            border-radius: 1.1rem;
            text-transform: uppercase;
        }

        .active-tab {
            color: white !important;
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .section-card {
            background-color: var(--tg-secondary-bg);
            border: 1px solid var(--card-border);
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .method-card {
            border: 2px solid var(--card-border);
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: var(--tg-secondary-bg);
        }

        .method-card.selected {
            background-color: var(--brand-green) !important;
            border-color: var(--brand-green);
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -5px rgba(21, 128, 61, 0.3);
        }

        .gateway-pill {
            border: 2px solid var(--card-border);
            transition: all 0.2s ease;
            cursor: pointer;
            filter: grayscale(1);
            opacity: 0.7;
            background-color: var(--tg-bg);
        }

        .gateway-pill.selected {
            border-color: var(--brand-green);
            background-color: var(--brand-light);
            filter: grayscale(0);
            opacity: 1;
            transform: scale(1.05);
        }

        .input-style {
            background-color: var(--tg-bg);
            border: 2px solid var(--card-border);
            border-radius: 1rem;
            padding: 1rem;
            width: 100%;
            font-size: 16px;
            color: var(--tg-text);
            transition: all 0.2s;
        }

        .input-style:disabled { opacity: 0.8; background-color: rgba(0,0,0,0.04); }

        .tier-basic { color: #64748b; font-weight: 900; }
        .tier-pro { color: #2563eb; font-weight: 900; }
        .tier-elite { color: #d97706; font-weight: 900; }

        .animate-section { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .loader {
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            width: 18px; height: 18px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="select-none">

    <header class="glass-header sticky top-0 z-50 px-5 py-5 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-green-700 rounded-2xl flex items-center justify-center text-2xl shadow-lg">üè°</div>
            <div>
                <h1 class="text-base font-black uppercase leading-tight">·ä•·àÅ·ãµ·äï ·â†·çç·âÖ·à≠</h1>
                <div class="flex items-center gap-1.5 mt-1">
                    <p id="headerLevel" class="text-[11px] font-black tier-basic uppercase tracking-widest">·àò·à†·à®·â≥·ãä</p>
                </div>
            </div>
        </div>
        <div class="text-right">
            <span id="userName" class="text-sm font-black block truncate max-w-[120px]">·ä†·â£·àç</span>
            <div id="adminBadge" class="hidden mt-1 px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-black rounded-full border border-amber-200 inline-block uppercase">Admin</div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-5 pb-24">
        <nav id="mainNav" class="nav-container grid grid-cols-4 gap-1 mb-10 shadow-xl">
            <button onclick="showTab('payment')" id="paymentTab" class="nav-btn py-4 active-tab">·ä≠·çç·ã´</button>
            <button onclick="showTab('status')" id="statusTab" class="nav-btn py-4">·àÅ·äî·â≥</button>
            <button onclick="showTab('loan')" id="loanTab" class="nav-btn py-4">·â•·ãµ·à≠</button>
            <button onclick="showTab('admin')" id="adminTab" class="nav-btn py-4 hidden">·ä†·ãµ·àö·äï</button>
            <button onclick="showTab('help')" id="helpTab" class="nav-btn py-4">·ä•·à≠·ã≥·â≥</button>
        </nav>

        <!-- 1. Payment Section -->
        <section id="paymentSection" class="animate-section space-y-8">
            <div class="space-y-4">
                <h3 class="text-xs font-black uppercase opacity-60 tracking-[0.2em] ml-1">·ã®·ä≠·çç·ã´ ·àù·à≠·å´</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div id="manualBtn" class="method-card p-6 rounded-[2rem] flex flex-col items-center gap-3 selected" onclick="selectPaymentMode('manual')">
                        <span class="text-3xl">üßæ</span>
                        <span class="text-xs font-black uppercase tracking-wider">·â†·ã∞·à®·à∞·äù</span>
                    </div>
                    <div id="easypayBtn" class="method-card p-6 rounded-[2rem] flex flex-col items-center gap-3" onclick="selectPaymentMode('easypay')">
                        <span class="text-3xl">üí≥</span>
                        <span class="text-xs font-black uppercase tracking-wider">·âÄ·àã·àç ·ä≠·çç·ã´</span>
                    </div>
                </div>
            </div>

            <div id="gatewaySelector" class="hidden section-card p-6 space-y-5">
                <h3 class="text-xs font-black uppercase opacity-50 text-center tracking-widest">·àò·â∞·åç·â†·à™·ã´ ·ã≠·àù·à®·å°</h3>
                <div class="grid grid-cols-3 gap-3">
                    <div class="gateway-pill p-3 rounded-2xl flex flex-col items-center selected" onclick="selectGateway('chapa', this)">
                        <img src="Chapa.png" class="w-10 h-10 mb-1 rounded-lg object-contain" onerror="this.src='https://ui-avatars.com/api/?name=C&background=000&color=fff'">
                        <span class="text-[9px] font-black uppercase">Chapa</span>
                    </div>
                    <div class="gateway-pill p-3 rounded-2xl flex flex-col items-center" onclick="selectGateway('telebirr', this)">
                        <img src="Telebirr.png" class="w-10 h-10 mb-1 rounded-lg object-contain" onerror="this.src='https://ui-avatars.com/api/?name=T&background=0052cc&color=fff'">
                        <span class="text-[9px] font-black uppercase">Telebirr</span>
                    </div>
                    <div class="gateway-pill p-3 rounded-2xl flex flex-col items-center" onclick="selectGateway('cbe', this)">
                        <img src="Cbe.png" class="w-10 h-10 mb-1 rounded-lg object-contain" onerror="this.src='https://ui-avatars.com/api/?name=E&background=6a1b9a&color=fff'">
                        <span class="text-[9px] font-black uppercase">CBE Birr</span>
                    </div>
                </div>
            </div>

            <form id="paymentForm" class="space-y-6">
                <div class="section-card p-6 space-y-6">
                    <div class="space-y-2">
                        <label class="text-[11px] font-black uppercase opacity-50 ml-1">·ã®·ä≠·çç·ã´ ·ãì·ã≠·äê·âµ</label>
                        <select id="paymentType" class="input-style font-black text-base" onchange="updatePenalty()">
                            <option value="·àò·ã∞·â†·äõ ·àò·ãã·åÆ">·àò·ã∞·â†·äõ ·àò·ãã·åÆ</option>
                            <option value="·ã®·â•·ãµ·à≠ ·àò·àò·àà·àª">·ã®·â•·ãµ·à≠ ·àò·àò·àà·àª</option>
                            <option value="·ã®·âÖ·å£·âµ ·ä≠·çç·ã´">·ã®·âÖ·å£·âµ ·ä≠·çç·ã´</option>
                            <option value="·àå·àã">·àå·àã</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[11px] font-black uppercase opacity-50 ml-1">·àò·å†·äï (·â•·à≠)</label>
                            <input type="number" id="amount" placeholder="0.00" required class="input-style font-black text-green-700">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[11px] font-black uppercase opacity-50 ml-1">·âÖ·å£·âµ (·â•·à≠)</label>
                            <input type="number" id="penalty" value="0" readonly class="input-style font-black text-red-600 bg-slate-50">
                        </div>
                    </div>
                </div>

                <div id="receiptWrapper" class="section-card p-6 space-y-4">
                    <label class="text-[11px] font-black uppercase opacity-50 ml-1">·ã®·ã∞·à®·à∞·äù ·çé·â∂ (Receipt)</label>
                    <div class="relative w-full aspect-video bg-black/5 rounded-3xl border-2 border-dashed border-black/10 flex flex-col items-center justify-center overflow-hidden transition-all hover:bg-black/10" onclick="document.getElementById('receiptInput').click()">
                        <div id="uploadPlaceholder" class="text-center">
                            <span class="text-4xl block mb-2">üì∏</span>
                            <span class="text-[10px] font-black opacity-40 uppercase tracking-widest">·àà·àò·å´·äï ·ã≠·äï·ä©</span>
                        </div>
                        <input type="file" id="receiptInput" accept="image/*" class="hidden" onchange="handlePreview(this)">
                        <img id="receiptPreview" src="" class="absolute inset-0 w-full h-full object-cover hidden">
                    </div>
                </div>

                <button type="submit" id="submitBtn" class="w-full py-5 bg-green-700 text-white rounded-[2rem] font-black text-lg shadow-2xl shadow-green-900/20 flex items-center justify-center gap-4 active:scale-95 transition-all">
                    <span id="btnText">·àò·à®·åÉ·ãç·äï ·àã·ä≠</span>
                </button>
            </form>
        </section>

        <!-- 2. Status Section -->
        <section id="statusSection" class="hidden animate-section space-y-8">
            <div class="bg-slate-900 p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden text-center">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-green-500/10 rounded-full blur-3xl"></div>
                <p class="text-xs font-bold opacity-40 uppercase tracking-[0.2em] mb-2">·ã®·å∏·ã∞·âÄ ·â∞·à≥·âµ·çé</p>
                <h2 class="text-6xl font-black" id="countDisplay">0</h2>
                <p id="statusLevel" class="text-xs mt-4 font-black uppercase text-green-400">·àò·à†·à®·â≥·ãä ·ä†·â£·àç</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="section-card p-6 flex flex-col items-center">
                    <span class="text-2xl block mb-2">üí∞</span>
                    <p class="text-[10px] font-black opacity-50 uppercase tracking-widest mb-1">·å†·âÖ·àã·àã ·ä≠·çç·ã´</p>
                    <p class="text-xl font-black" id="totalPaid">0.00</p>
                </div>
                <div class="section-card p-6 flex flex-col items-center">
                    <span class="text-2xl block mb-2">üîî</span>
                    <p class="text-[10px] font-black opacity-50 uppercase tracking-widest mb-1">·ã®·âÄ·à® ·ãï·ã≥</p>
                    <p class="text-xl font-black text-red-600" id="remainingDebt">0.00</p>
                </div>
            </div>

            <div class="space-y-4">
                <h4 class="text-xs font-black uppercase opacity-50 tracking-widest px-2">·ã®·âÖ·à≠·â• ·åä·ãú ·ä•·äï·âÖ·àµ·âÉ·à¥·ãé·âΩ</h4>
                <div id="transactionList" class="space-y-3">
                    <p class="text-center opacity-30 py-10 text-sm italic">·àù·äï·àù ·ä•·äï·âÖ·àµ·âÉ·à¥ ·ã®·àà·àù</p>
                </div>
            </div>
        </section>

        <!-- 3. Loan Section -->
        <section id="loanSection" class="hidden animate-section space-y-6">
            <div class="section-card p-10 text-center bg-slate-900 text-white relative overflow-hidden">
                <div class="w-20 h-20 bg-brand-green rounded-[2rem] flex items-center justify-center text-4xl mx-auto mb-6 shadow-2xl">üè¶</div>
                <h3 class="text-xl font-black uppercase">·ã®·â•·ãµ·à≠ ·ä†·åà·àç·åç·àé·âµ</h3>
                <p class="text-xs font-bold text-slate-400 mt-4 leading-relaxed">·ä†·åà·àç·åç·àé·â± ·à≤·åÄ·àù·à≠ ·ã®·çï·àÆ ·ä•·äì ·ã®·àç·ã© ·ä†·â£·àã·âµ ·âÖ·ãµ·àö·ã´ ·ã®·àõ·åç·äò·âµ ·ãï·ãµ·àç ·ã≠·äñ·à´·â∏·ãã·àç·ç¢</p>
                <div class="mt-6 inline-block px-4 py-2 bg-yellow-500/20 text-yellow-500 rounded-full text-[10px] font-black uppercase animate-pulse">·â†·åç·äï·â£·â≥ ·àã·ã≠</div>
            </div>
        </section>

        <!-- 4. Admin Section -->
        <section id="adminSection" class="hidden animate-section space-y-6">
            <div class="bg-amber-50 p-6 rounded-[2rem] border-2 border-amber-200">
                <h3 class="text-amber-900 font-black text-base uppercase">·ã®·ä†·àµ·â∞·ã≥·ã≥·à™ ·ä≠·çç·àç</h3>
                <p class="text-xs text-amber-700 font-bold mt-1 italic">·ã®·àö·å†·â£·â†·âÅ ·ä≠·çç·ã´·ãé·âΩ·äï ·ä•·ãö·àÖ ·åã·à≠ ·àõ·åΩ·ã∞·âÖ ·ã≠·âΩ·àã·àâ·ç¢</p>
            </div>
            <div id="adminPendingList" class="space-y-4">
                <p class="text-center opacity-30 py-10 text-sm font-bold">·àù·äï·àù ·ã®·àö·å†·â£·â†·âÖ ·ä≠·çç·ã´ ·ã®·àà·àù</p>
            </div>
        </section>

        <!-- 5. Help Section -->
        <section id="helpSection" class="hidden animate-section space-y-6">
            <div class="section-card p-8 space-y-6">
                <h4 class="text-base font-black uppercase border-b border-black/5 pb-4">·àò·àò·à™·ã´·ãé·âΩ</h4>
                <div class="space-y-5 text-sm font-semibold text-slate-600 leading-relaxed">
                    <div class="flex gap-4">
                        <span class="w-8 h-8 bg-green-100 text-green-700 rounded-lg flex items-center justify-center font-black flex-shrink-0">1</span>
                        <p>·â†·àò·åÄ·àò·à™·ã´ ·ã®·ä≠·çç·ã´ ·åà·åΩ ·àã·ã≠ ·â†·àò·åç·â£·âµ ·ã®·ä≠·çç·ã´·ãé·äï ·àò·à®·åÉ ·â†·âµ·ä≠·ä≠·àç ·ã≠·àô·àâ::</p>
                    </div>
                    <div class="flex gap-4">
                        <span class="w-8 h-8 bg-green-100 text-green-700 rounded-lg flex items-center justify-center font-black flex-shrink-0">2</span>
                        <p>·â†·ã∞·à®·à∞·äù ·ä≠·çç·ã´ ·à≤·çà·åΩ·àô ·ã®·â£·äï·ä≠ ·ã∞·à®·à∞·äô·äï ·çé·â∂ ·â†·âµ·ä≠·ä≠·àç ·àò·å´·äï·ãé·äï ·ã´·à®·åã·åç·å°::</p>
                    </div>
                </div>
            </div>
            <!-- Contact Admin Link - Strictly Admin Only -->
            <a id="adminHelpLink" href="https://t.me/Abiym" target="_blank" class="hidden bg-blue-600/10 border border-blue-600/20 p-6 rounded-[2rem] flex items-center justify-between active:scale-95 transition-all">
                <div class="flex items-center gap-5">
                    <div class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-2xl shadow-xl">üí¨</div>
                    <div>
                        <h4 class="text-sm font-black text-blue-900 uppercase">·ä•·à≠·ã≥·â≥ ·ã≠·çà·àç·åã·àâ?</h4>
                        <p class="text-[10px] font-bold text-blue-700/60 mt-1">·ä†·àµ·â∞·ã≥·ã≥·à™·ãç·äï ·ã´·äê·åã·åç·à©</p>
                    </div>
                </div>
                <span class="text-blue-600 text-xl font-black">‚Üí</span>
            </a>
        </section>

        <footer class="mt-12 text-center opacity-20">
            <p class="text-[10px] font-black uppercase tracking-[0.4em]">Edir Digital v3.6 ‚Ä¢ SkyMark</p>
        </footer>
    </main>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // State Management
        window.paymentMode = 'manual';
        window.selectedGateway = 'chapa';
        
        /**
         * ADMIN_LIST
         * IMPORTANT: Add your personal Telegram User ID here as a string.
         * You can get your ID from @userinfobot or @MissRose_bot on Telegram.
         */
        const ADMIN_LIST = ["644558000", "ADD_YOUR_ID_HERE"]; 

        function checkRole() {
            // Get user data from Telegram WebApp
            const user = tg.initDataUnsafe?.user;
            
            if (user && ADMIN_LIST.includes(user.id.toString())) {
                const adminTab = document.getElementById('adminTab');
                const adminBadge = document.getElementById('adminBadge');
                const adminHelpLink = document.getElementById('adminHelpLink');
                const mainNav = document.getElementById('mainNav');

                // Show admin elements
                if (adminTab) adminTab.classList.remove('hidden');
                if (adminBadge) adminBadge.classList.remove('hidden');
                if (adminHelpLink) adminHelpLink.classList.remove('hidden');
                
                // Switch navigation to 5 columns to fit the Admin tab
                if (mainNav) {
                    mainNav.classList.remove('grid-cols-4');
                    mainNav.classList.add('grid-cols-5');
                }
            } else {
                console.log("Not an admin or outside Telegram environment.");
            }
        }

        window.showTab = (t) => {
            const tabs = ['payment', 'status', 'loan', 'admin', 'help'];
            tabs.forEach(s => {
                const sec = document.getElementById(s + 'Section');
                const btn = document.getElementById(s + 'Tab');
                if (sec) sec.classList.add('hidden');
                if (btn) btn.classList.remove('active-tab');
            });

            const activeSec = document.getElementById(t + 'Section');
            const activeTab = document.getElementById(t + 'Tab');
            if (activeSec) activeSec.classList.remove('hidden');
            if (activeTab) activeTab.classList.add('active-tab');

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.selectPaymentMode = (mode) => {
            window.paymentMode = mode;
            document.getElementById('manualBtn').classList.toggle('selected', mode === 'manual');
            document.getElementById('easypayBtn').classList.toggle('selected', mode === 'easypay');
            document.getElementById('gatewaySelector').classList.toggle('hidden', mode === 'manual');
            document.getElementById('receiptWrapper').classList.toggle('hidden', mode === 'easypay');
            document.getElementById('btnText').innerText = mode === 'manual' ? '·àò·à®·åÉ·ãç·äï ·àã·ä≠' : '·àà·àò·ä≠·çà·àç ·âÄ·å•·àç';
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        };

        window.selectGateway = (gateway, el) => {
            window.selectedGateway = gateway;
            document.querySelectorAll('.gateway-pill').forEach(p => p.classList.remove('selected'));
            el.classList.add('selected');
            if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
        };

        window.handlePreview = (i) => {
            if (i.files[0]) {
                const r = new FileReader();
                r.onload = (e) => {
                    const pr = document.getElementById('receiptPreview');
                    const ph = document.getElementById('uploadPlaceholder');
                    if(pr) { pr.src = e.target.result; pr.classList.remove('hidden'); }
                    if(ph) ph.classList.add('hidden');
                };
                r.readAsDataURL(i.files[0]);
            }
        };

        window.updatePenalty = () => {
            const type = document.getElementById('paymentType').value;
            const penaltyInput = document.getElementById('penalty');
            if (type !== '·àò·ã∞·â†·äõ ·àò·ãã·åÆ') penaltyInput.value = 0;
        };

        document.getElementById('paymentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const amt = document.getElementById('amount').value;
            const type = document.getElementById('paymentType').value;
            if(!amt || amt <= 0) {
                tg.showPopup({ message: "·ä•·â£·ä≠·ãé ·àò·å†·äï ·ã´·àµ·åà·â°" });
                return;
            }

            const payload = { 
                type: 'payment_report', 
                gateway: window.paymentMode === 'manual' ? 'manual' : window.selectedGateway, 
                purpose: type, 
                totalAmount: amt,
                isDigital: window.paymentMode === 'easypay'
            };
            
            tg.sendData(JSON.stringify(payload));
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => tg.close(), 1000);
        });

        // Run role check on load
        setTimeout(checkRole, 500);
        
        if (tg.initDataUnsafe?.user) {
            document.getElementById('userName').innerText = tg.initDataUnsafe.user.first_name || "·ä†·â£·àç";
        }
    </script>
</body>
</html>
